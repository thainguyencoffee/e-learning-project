<div *ngIf="getIdRequestUnresolved() as idRequest" class="alert alert-warning rounded shadow-sm mb-4">
  This course has a pending request. Please
  <a [routerLink]="['/administration/courses', currentId, 'requests', idRequest]">resolve</a> the request.
</div>

<div class="d-flex justify-content-between align-items-center mb-4 border-bottom pb-2">
  <h1 class="text-primary fw-bold">Course Detail Center</h1>
  <a routerLink="/administration/courses" class="btn btn-outline-secondary">
    <i class="bi bi-arrow-left"></i> Back to list
  </a>
</div>

<div class="container-fluid bg-light p-4 rounded shadow-sm" *ngIf="courseDto">
  <!-- Basic Info Section -->
  <section id="basic" class="p-4 border rounded mb-4 bg-white">
    <h2 class="mb-4 border-bottom pb-2">Basic Information</h2>
    <div class="row">
      <div class="col-lg-4 text-center">
        <img
          [src]="courseDto.thumbnailUrl || 'https://placehold.jp/200x200.png'"
          class="img-fluid rounded shadow-sm mb-3"
          alt="Course Thumbnail">
      </div>
      <div class="col-lg-8">
        <p><strong>Title:</strong> {{ courseDto.title }}</p>
        <p>
          <strong>Teacher:</strong>
          <span *ngIf="isCreateByYou(courseDto.teacher)" class="badge bg-secondary">This account</span>
          <span *ngIf="!isCreateByYou(courseDto.teacher)">{{ courseDto.teacher }}</span>
        </p>
        <p><strong>Description:</strong> {{ courseDto.description || 'No description available' }}</p>
        <p><strong>Language:</strong> <span class="fw-bold">{{ courseDto.language }}</span></p>
        <p><strong>Price:</strong> {{ courseDto.price || 'Price not available' }}</p>
        <p class="badge {{ courseDto.published ? 'bg-success' : 'bg-primary' }}">
          Status: {{ courseDto.published ? 'Published' : 'Not published' }}
        </p>
      </div>
    </div>
  </section>

  <!-- Subtitles, Benefits, and Prerequisites -->
  <div class="row mb-4">
    <div class="col-md-4">
      <div class="p-3 border rounded bg-white">
        <h5>Subtitles</h5>
        <ul class="list-group">
          <li *ngFor="let subtitle of courseDto?.subtitles" class="list-group-item">
            {{ subtitle }}
          </li>
          <li *ngIf="!courseDto?.subtitles?.length" class="list-group-item text-muted">No subtitles available</li>
        </ul>
      </div>
    </div>
    <div class="col-md-4">
      <div class="p-3 border rounded bg-white">
        <h5>Benefits</h5>
        <ul class="list-group">
          <li *ngFor="let benefit of courseDto?.benefits" class="list-group-item">
            {{ benefit }}
          </li>
          <li *ngIf="!courseDto?.benefits?.length" class="list-group-item text-muted">No benefits available</li>
        </ul>
      </div>
    </div>
    <div class="col-md-4">
      <div class="p-3 border rounded bg-white">
        <h5>Prerequisites</h5>
        <ul class="list-group">
          <li *ngFor="let prerequisite of courseDto?.prerequisites" class="list-group-item">
            {{ prerequisite }}
          </li>
          <li *ngIf="!courseDto?.prerequisites?.length" class="list-group-item text-muted">No prerequisites available</li>
        </ul>
      </div>
    </div>
  </div>

  <!-- Accessibility Section -->
  <section id="accessibility" class="p-4 border rounded mb-4 bg-white">
    <h2 class="mb-4 border-bottom pb-2">Accessibility</h2>
    <p><strong>Created By:</strong>
      <span *ngIf="isCreateByYou(courseDto.createdBy)" class="badge bg-secondary">This account</span>
      <span *ngIf="!isCreateByYou(courseDto.createdBy)">{{ courseDto.createdBy }}</span>
    </p>
    <p><strong>Created Date:</strong> {{ courseDto.createdDate }}</p>
    <p><strong>Last Modified By:</strong>
      <span *ngIf="isCreateByYou(courseDto.lastModifiedBy)" class="badge bg-secondary">This account</span>
      <span *ngIf="!isCreateByYou(courseDto.lastModifiedBy)">{{ courseDto.lastModifiedBy }}</span>
    </p>
    <p><strong>Last Modified Date:</strong> {{ courseDto.lastModifiedDate }}</p>
  </section>

  <!--Section-->
  <div id="sections">
    <h5>Sections</h5>

    <div *ngIf="courseDto?.sections?.length === 0">
    <span class="badge bg-dark">
      No prerequisites available
    </span>
    </div>

    <div *ngIf="courseDto?.sections?.length !== 0" class="table-responsive">
      <table class="table table-striped table-hover align-middle">
        <thead>
        <tr>
          <th scope="col">Id</th>
          <th scope="col">Title</th>
          <th><!-- --></th>
        </tr>
        </thead>
        <tbody>
        <tr *ngFor="let section of courseDto.sections;">
          <td>{{ section.id }}</td>

          <td type="button" data-bs-toggle="collapse"
              [attr.data-bs-target]="'#collapse' + section.id"
              aria-expanded="false" [attr.aria-controls]="'#collapse' + section.id"
          >{{ section.title }}
          </td>

          <td>
            <div class="float-end text-nowrap d-flex">
              <a [routerLink]="['/administration/courses/', currentId, 'sections', section.id]"
                 class="btn btn-sm btn-secondary me-2">View section detail</a>
              <a *ngIf="isEditable()" [routerLink]="['/administration/courses', currentId, 'sections', 'edit', section.id]"
                 class="btn btn-sm btn-secondary me-2">Edit Section</a>
              <a *ngIf="isEditable()" [routerLink]="['/administration/courses', currentId, 'sections', section.id, 'lessons', 'add']"
                 class="btn btn-sm btn-secondary me-2">Add Lesson</a>
              <button *ngIf="isEditable()" type="button" (click)="confirmDeleteSection(section.id, section)"
                      class="btn btn-sm btn-secondary me-2">Delete
              </button>
            </div>
          </td>
        </tr>
        </tbody>
      </table>
    </div>

    <div *ngFor="let section of courseDto.sections;">
      <div class="collapse table-responsive" [attr.id]="'collapse' + section.id">
        <table class="table table-striped table-hover align-middle">
          <thead>
          <tr>
            <th>Id</th>
            <th>Title</th>
            <td>Type</td>
            <th>Preview</th>
            <th><!-- --></th>
          </tr>
          </thead>
          <tbody>
          <tr *ngFor="let lesson of section.lessons">
            <td>{{ lesson.id }}</td>
            <td>{{ lesson.title }}</td>
            <td>{{ lesson.type }}</td>
            <td><a [href]="lesson.link" target="_blank">View content</a></td>

            <td>
              <a *ngIf="isEditable()" [routerLink]="['/administration/courses', currentId, 'sections', section.id, 'lessons', 'edit', lesson.id]"
                 class="btn btn-sm btn-secondary me-2">Edit Lesson</a>
              <button *ngIf="isEditable()" type="button" (click)="confirmDeleteLesson(section.id, lesson.id, lesson)"
                      class="btn btn-sm btn-secondary me-2">Delete
              </button>
            </td>
          </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
