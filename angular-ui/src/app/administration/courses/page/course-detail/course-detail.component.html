<div *ngIf="getIdRequestUnresolved() as idRequest" class="alert alert-warning rounded shadow-sm mb-4">
  This course has a pending request. Please
  <a [routerLink]="['/administration/courses', currentId, 'requests', idRequest]">resolve</a> the request.
</div>

<div class="d-flex justify-content-between align-items-center mb-4 border-bottom pb-2">
  <h1 class="text-primary fw-bold">Course Detail Center</h1>
  <a routerLink="/administration/courses" class="btn btn-outline-secondary">
    <i class="bi bi-arrow-left"></i> Back to list
  </a>
</div>

<div class="container-fluid bg-light p-4 rounded shadow-sm" *ngIf="courseDto">
  <!-- Basic Info Section -->
  <section id="basic" class="p-4 border rounded mb-4 bg-white">
    <h2 class="mb-4 border-bottom pb-2">Basic Information</h2>
    <div class="row">
      <div class="col-lg-4 text-center">
        <img
          [src]="courseDto.thumbnailUrl || 'https://placehold.jp/200x200.png'"
          class="img-fluid rounded shadow-sm mb-3"
          alt="Course Thumbnail"
          style="width: auto; height: 300px; object-fit: cover;">
      </div>
      <div class="col-lg-8">
        <p><strong>Title:</strong> {{ courseDto.title }}</p>
        <p>
          <strong>Teacher: </strong>
          <span *ngIf="isCreateByYou(courseDto.teacher)">{{ courseDto.teacher }}
            <span class="badge bg-secondary">this account</span>
          </span>
          <span *ngIf="!isCreateByYou(courseDto.teacher)">{{ courseDto.teacher }}</span>
        </p>
        <p><strong>Participant: {{participantNumber}} - <a [routerLink]="['/administration/enrolment-statistics', courseDto.id]">Enrolment statistic</a></strong></p>
        <p><strong>Description: </strong> {{ courseDto.description || 'No description available' }}</p>
        <p><strong>Language: </strong> <span class="fw-bold">{{ courseDto.language }}</span></p>
        <p><strong>Price: </strong> {{ courseDto.price || 'Price not available' }}</p>
        <p class="badge {{ courseDto.published ? 'bg-success' : 'bg-primary' }}">
          Status: {{ courseDto.published ? 'Published' : 'Not published' }}
        </p>
      </div>
    </div>
  </section>
  <!-- Subtitles, Benefits, and Prerequisites -->
  <div class="row mb-4">
    <div class="col-md-4">
      <div class="p-3 border rounded bg-white">
        <h5>Subtitles</h5>
        <ul class="list-group">
          <li *ngFor="let subtitle of courseDto?.subtitles" class="list-group-item">
            {{ subtitle }}
          </li>
          <li *ngIf="!courseDto?.subtitles?.length" class="list-group-item text-muted">No subtitles available</li>
        </ul>
      </div>
    </div>
    <div class="col-md-4">
      <div class="p-3 border rounded bg-white">
        <h5>Benefits</h5>
        <ul class="list-group">
          <li *ngFor="let benefit of courseDto?.benefits" class="list-group-item">
            {{ benefit }}
          </li>
          <li *ngIf="!courseDto?.benefits?.length" class="list-group-item text-muted">No benefits available</li>
        </ul>
      </div>
    </div>
    <div class="col-md-4">
      <div class="p-3 border rounded bg-white">
        <h5>Prerequisites</h5>
        <ul class="list-group">
          <li *ngFor="let prerequisite of courseDto?.prerequisites" class="list-group-item">
            {{ prerequisite }}
          </li>
          <li *ngIf="!courseDto?.prerequisites?.length" class="list-group-item text-muted">No prerequisites available</li>
        </ul>
      </div>
    </div>
  </div>

  <!-- Accessibility Section -->
  <section id="accessibility" class="p-4 border rounded mb-4 bg-white">
    <h2 class="mb-4 border-bottom pb-2">Accessibility</h2>
    <p><strong>Created By: </strong>
      <span *ngIf="isCreateByYou(courseDto.createdBy)">{{ courseDto.createdBy }}
        <span class="badge bg-secondary">this account</span>
      </span>
      <span *ngIf="!isCreateByYou(courseDto.createdBy)">{{ courseDto.createdBy }}</span>
    </p>
    <p><strong>Created Date: </strong> {{ courseDto.createdDate | date:'yyyy-MM-dd HH:mm:ss' }}</p>
    <p><strong>Last Modified By: </strong>
      <span *ngIf="isCreateByYou(courseDto.lastModifiedBy)">{{ courseDto.lastModifiedBy }}
        <span class="badge bg-secondary">this account</span>
      </span>
      <span *ngIf="!isCreateByYou(courseDto.lastModifiedBy)">{{ courseDto.lastModifiedBy }}</span>
    </p>
    <p><strong>Last Modified Date:</strong> {{ courseDto.lastModifiedDate | date: 'yyyy-MM-dd HH:mm:ss' }}</p>
  </section>
  <!--Section-->
  <section id="sections" class="p-4 border rounded mb-4 bg-white">
    <h2 class="mb-4 border-bottom pb-2">Sections</h2>
    <!--Section-->
  <div class="accordion mt-4" id="courseSections">
    <div *ngFor="let section of courseDto.sections; let i = index" class="accordion-item mb-3 border rounded">
      <!-- Accordion Header -->
      <h2 class="accordion-header" [attr.id]="'heading' + section.id">
        <div class="d-flex align-items-center justify-content-between px-3 py-2">
          <!-- Title và nút collapse -->
          <span class="badge bg-primary me-2">{{ section.lessons.length }} Lesson</span>
          <button
            class="accordion-button collapsed bg-light text-dark fw-bold p-0 me-3"
            type="button"
            data-bs-toggle="collapse"
            [attr.data-bs-target]="'#collapse' + section.id"
            aria-expanded="false"
            [attr.aria-controls]="'collapse' + section.id"
          >
            <span>{{ section.orderIndex + '-' + section.title }}</span>
          </button>

          <!-- Badge và nhóm button -->
          <div class="d-flex align-items-center">
            <div class="d-flex gap-2">
              <a [routerLink]="['/administration/courses/', currentId, 'sections', section.id]"
                 class="btn btn-secondary btn-sm custom-button">View Detail</a>
              <a *ngIf="isEditable()"
                 [routerLink]="['/administration/courses', currentId, 'sections', 'edit', section.id]"
                 class="btn btn-secondary btn-sm custom-button">Edit</a>
              <a *ngIf="isEditable()"
                 [routerLink]="['/administration/courses', currentId, 'sections', section.id, 'lessons', 'add']"
                 class="btn btn-secondary btn-sm custom-button">Add Lesson</a>
              <button *ngIf="isEditable()"
                      type="button"
                      (click)="confirmDeleteSection(section.id, section)"
                      class="btn btn-secondary btn-sm custom-button">Delete</button>
            </div>
          </div>
        </div>
      </h2>
      <!-- Accordion Content -->
      <div
        [attr.id]="'collapse' + section.id"
        class="accordion-collapse collapse"
        [attr.aria-labelledby]="'heading' + section.id"
        data-bs-parent="#courseSections"
      >
        <div class="accordion-body border-top">
          <ul class="list-group border-0">
            <li *ngFor="let lesson of section.lessons; let j = index"
                class="list-group-item d-flex justify-content-between align-items-center border-0">
              <span class="fw-bold">{{ lesson.orderIndex }}. {{ lesson.title }}</span>
              <a [href]="lesson.link" target="_blank" class="btn btn-outline-success custom-button">
                View content
              </a>
              <a *ngIf="isEditable()"
                 [routerLink]="['/administration/courses', currentId, 'sections', section.id, 'lessons', 'edit', lesson.id]"
                 class="btn btn-secondary btn-sm custom-button">Edit</a>
              <a *ngIf="isEditable()"
                 [routerLink]="['/administration/courses', currentId, 'sections', section.id, 'lessons', lesson.id, 'quizzes']"
                 class="btn btn-secondary btn-sm custom-button">Manage quiz</a>
              <button *ngIf="isEditable()"
                      type="button"
                      (click)="confirmDeleteLesson(section.id, lesson.id, lesson)"
                      class="btn btn-secondary btn-sm custom-button">Delete</button>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>
  </section>
</div>

